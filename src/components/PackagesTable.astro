---
import { CodeXml, Home } from "lucide-react";
import { Package } from "~/lib/package";

interface Props {
	packages: Package[];
}

const { packages } = Astro.props;
---

<div class="overflow-hidden rounded-xl border border-neon-white/10 bg-neon-black/30 backdrop-blur-xl">
	<table class="border-collapse border table-fixed">
		<thead>
			<tr class="border-b border-neon-white/10 bg-neon-black/40">
				<th class="px-6 py-4 text-left text-sm font-medium text-neon-white/60 w-3/12">Package</th>
				<th class="px-6 py-4 text-left text-sm font-medium text-neon-white/60 w-3/12">Nix Name</th>
				<th class="px-6 py-4 text-left text-sm font-medium text-neon-white/60 w-5/12">Description</th>
				<th class="px-6 py-4 text-left text-sm font-medium text-neon-white/60 w-1/12">Version</th>
				<th class="px-6 py-4 text-left text-sm font-medium text-neon-white/60 w-1/12">Links</th>
			</tr>
		</thead>
		<tbody class="divide-y divide-neon-white/10">
			{
				packages.map((pkg) => (
					<tr class="group hover:bg-neon-white/5 transition-colors h-20">
						<td class="px-6 py-4 w-3/12">
							<a href={`/package/${pkg.pname}`} class="flex items-center gap-3 group/link">
								<div class="w-8 h-8 rounded-lg bg-neon-white/5 flex items-center justify-center">
									<img
										src={`https://icon.horse/icon/${new URL(pkg.nix.meta.homepage ?? "").hostname}`}
										class="w-5 h-5"
										loading="lazy"
									/>
								</div>
								<span class="font-medium text-neon-white group-hover/link:text-neon-purple transition-colors">
									{pkg.name}
								</span>
							</a>
						</td>
						<td class="px-6 py-4 w-3/12">
							<a href={`/package/${pkg.pname}`} class="block group/link">
								<code class="px-2 py-1 text-sm bg-neon-white/5 text-neon-white/80 rounded group-hover/link:bg-neon-white/10 transition-colors">
									{pkg.pname}
								</code>
							</a>
						</td>
						<td class="px-6 py-4 w-5/12">
							<p class="text-neon-white/80 line-clamp-2 hover:text-neon-white transition-colors">
								{pkg.nix.meta.description}
							</p>
						</td>
						<td class="px-6 py-4 w-1/12">
							<span class="max-w-[10ch] overflow-ellipsis whitespace-nowrap">{pkg.version}</span>
						</td>
						<td class="px-6 py-4 w-1/12">
							<div class="flex items-center gap-2">
								<a
									href={pkg.nix.meta.homepage}
									target="_blank"
									rel="noopener noreferrer"
									class="p-2 text-neon-white/60 hover:text-neon-purple transition-colors rounded-lg hover:bg-neon-white/5"
									title="Visit homepage"
								>
									<Home className="w-5 h-5" />
								</a>
								<a
									href={`/api/package/${pkg.pname}/${pkg.version}`}
									target="_blank"
									rel="noopener noreferrer"
									class="p-2 text-neon-white/60 hover:text-neon-purple transition-colors rounded-lg hover:bg-neon-white/5"
									title="View source"
								>
									<CodeXml className="w-5 h-5" />
								</a>
							</div>
						</td>
					</tr>
				))
			}
		</tbody>
	</table>
</div>
