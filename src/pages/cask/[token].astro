---
import Layout from "../../layouts/Layout.astro";
import { Cask, caskToNix } from "../../lib/homebrew";

const { token } = Astro.params;
if (!token) {
  throw new Error("Missing token");
}

const response = await fetch(`https://formulae.brew.sh/api/cask/${token}.json`);
if (!response.ok) {
  throw new Error(`Failed to fetch cask ${token}`);
}
const cask = Cask.parse(await response.json());
const nix = caskToNix(cask);
---

<Layout title={`${nix.pname} | Nix Casks`} description={nix.meta.description ?? nix.pname}>
  <h1 class="text-4xl font-semibold">{nix.pname} - {nix.version}</h1>
  <div class="flex items-center gap-2">
    <a class="block" target="_blank" rel="noopener noreferrer" href={nix.meta.homepage}>Homepage</a>
  </div>
  <p>{nix.meta.description}</p>
  <h2 class="text-2xl font-semibold">Nix Derivation</h2>
  <pre>{JSON.stringify(nix, null, 2)}</pre>
  <h2 class="text-2xl font-semibold">Homebrew Cask</h2>
  <pre>{JSON.stringify(cask, null, 2)}</pre>
</Layout>
